{"ast":null,"code":"import{useState,useEffect}from'react';import{Box,Button,CircularProgress}from'@mui/material';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export const HubspotIntegration=_ref=>{let{user,org,integrationParams,setIntegrationParams}=_ref;const[isConnected,setIsConnected]=useState(false);const[isConnecting,setIsConnecting]=useState(false);const handleConnectClick=async()=>{try{setIsConnecting(true);const formData=new FormData();formData.append('user_id',user);formData.append('org_id',org);const response=await axios.post(\"http://localhost:8000/integrations/hubspot/authorize\",formData);const authURL=response===null||response===void 0?void 0:response.data;const newWindow=window.open(authURL,'HubSpot Authorization','width=600, height=600');const pollTimer=window.setInterval(()=>{if((newWindow===null||newWindow===void 0?void 0:newWindow.closed)!==false){window.clearInterval(pollTimer);handleWindowClosed();}},200);}catch(e){var _e$response,_e$response$data;setIsConnecting(false);alert((e===null||e===void 0?void 0:(_e$response=e.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.detail)||\"Authorization failed\");}};const handleWindowClosed=async()=>{try{const formData=new FormData();formData.append('user_id',user);formData.append('org_id',org);const response=await axios.post(\"http://localhost:8000/integrations/hubspot/credentials\",formData);const credentials=response.data;if(credentials){setIsConnecting(false);setIsConnected(true);setIntegrationParams(prev=>({...prev,credentials:credentials,type:'Hubspot'}));}}catch(e){var _e$response2,_e$response2$data;setIsConnecting(false);alert((e===null||e===void 0?void 0:(_e$response2=e.response)===null||_e$response2===void 0?void 0:(_e$response2$data=_e$response2.data)===null||_e$response2$data===void 0?void 0:_e$response2$data.detail)||\"Failed to fetch credentials\");}};useEffect(()=>{setIsConnected((integrationParams===null||integrationParams===void 0?void 0:integrationParams.type)==='Hubspot'&&integrationParams!==null&&integrationParams!==void 0&&integrationParams.credentials?true:false);},[]);return/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[\"Parameters\",/*#__PURE__*/_jsx(Box,{display:\"flex\",alignItems:\"center\",justifyContent:\"center\",sx:{mt:2},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:isConnected?()=>{}:handleConnectClick,color:isConnected?'success':'primary',disabled:isConnecting,style:{pointerEvents:isConnected?'none':'auto',cursor:isConnected?'default':'pointer',opacity:isConnected?1:undefined},children:isConnected?'HubSpot Connected':isConnecting?/*#__PURE__*/_jsx(CircularProgress,{size:20}):'Connect to HubSpot'})})]});};","map":{"version":3,"names":["useState","useEffect","Box","Button","CircularProgress","axios","jsx","_jsx","jsxs","_jsxs","HubspotIntegration","_ref","user","org","integrationParams","setIntegrationParams","isConnected","setIsConnected","isConnecting","setIsConnecting","handleConnectClick","formData","FormData","append","response","post","authURL","data","newWindow","window","open","pollTimer","setInterval","closed","clearInterval","handleWindowClosed","e","_e$response","_e$response$data","alert","detail","credentials","prev","type","_e$response2","_e$response2$data","sx","mt","children","display","alignItems","justifyContent","variant","onClick","color","disabled","style","pointerEvents","cursor","opacity","undefined","size"],"sources":["/Users/aditichinta/Downloads/integrations_technical_assessment/frontend/src/integrations/hubspot.js"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport {\n    Box,\n    Button,\n    CircularProgress\n} from '@mui/material';\nimport axios from 'axios';\n\nexport const HubspotIntegration = ({ user, org, integrationParams, setIntegrationParams }) => {\n    const [isConnected, setIsConnected] = useState(false);\n    const [isConnecting, setIsConnecting] = useState(false);\n\n    const handleConnectClick = async () => {\n        try {\n            setIsConnecting(true);\n            const formData = new FormData();\n            formData.append('user_id', user);\n            formData.append('org_id', org);\n            const response = await axios.post(`http://localhost:8000/integrations/hubspot/authorize`, formData);\n            const authURL = response?.data;\n\n            const newWindow = window.open(authURL, 'HubSpot Authorization', 'width=600, height=600');\n\n            const pollTimer = window.setInterval(() => {\n                if (newWindow?.closed !== false) {\n                    window.clearInterval(pollTimer);\n                    handleWindowClosed();\n                }\n            }, 200);\n        } catch (e) {\n            setIsConnecting(false);\n            alert(e?.response?.data?.detail || \"Authorization failed\");\n        }\n    };\n\n    const handleWindowClosed = async () => {\n        try {\n            const formData = new FormData();\n            formData.append('user_id', user);\n            formData.append('org_id', org);\n            const response = await axios.post(`http://localhost:8000/integrations/hubspot/credentials`, formData);\n            const credentials = response.data;\n            if (credentials) {\n                setIsConnecting(false);\n                setIsConnected(true);\n                setIntegrationParams(prev => ({ ...prev, credentials: credentials, type: 'Hubspot' }));\n            }\n        } catch (e) {\n            setIsConnecting(false);\n            alert(e?.response?.data?.detail || \"Failed to fetch credentials\");\n        }\n    };\n\n    useEffect(() => {\n        setIsConnected(integrationParams?.type === 'Hubspot' && integrationParams?.credentials ? true : false);\n    }, []);\n\n    return (\n        <Box sx={{ mt: 2 }}>\n            Parameters\n            <Box display='flex' alignItems='center' justifyContent='center' sx={{ mt: 2 }}>\n                <Button\n                    variant='contained'\n                    onClick={isConnected ? () => {} : handleConnectClick}\n                    color={isConnected ? 'success' : 'primary'}\n                    disabled={isConnecting}\n                    style={{\n                        pointerEvents: isConnected ? 'none' : 'auto',\n                        cursor: isConnected ? 'default' : 'pointer',\n                        opacity: isConnected ? 1 : undefined\n                    }}\n                >\n                    {isConnected ? 'HubSpot Connected' : isConnecting ? <CircularProgress size={20} /> : 'Connect to HubSpot'}\n                </Button>\n            </Box>\n        </Box>\n    );\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}